name: deploy ansible and run ansible playbook

on:
  push:
    branches: [feature/init, main]

jobs:  
  ansible-lint-check:
    runs-on: ubuntu-latest
    steps:
    - name: checkout repo
      uses: actions/checkout@v2
       
    
    - name: Set up Ansible
      run: |
        sudo apt-get -y update; \
        sudo apt-get -y install ansible; \
        ansible --version

    - name: Connect to Azure VM 
      run: |
        # echo "${{ secrets.AZURE_PEM }}" | tr -d '\r' > test_key.pem
        echo "${{ secrets.AZURE_PEM }}" > test_key.pem
        chmod 400 test_key.pem
        
        ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook main.yaml -i hosts --key-file test_key.pem 

               
    
       
      
        

    # - name: testing ansible ping
    #   run: ansible all -i 20.103.151.129
                      
    # - name: Lint Ansible Playbook
    #   uses: ansible/ansible-lint-action@main
    #   with:
    #     targets: "main.yaml"
  
  # deploy-ansible-playbook:
  #   #needs: ansible-lint-check
  #   runs-on: ubuntu-latest
  #   steps:
  #   - uses: actions/checkout@v1

  #   - name: Running playbook
  #     run: ansible-playbook main.yaml

  #   - name: checking status 
  #     run: sudo systemctl status apache2   



